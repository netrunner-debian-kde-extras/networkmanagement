#!/usr/bin/make -f

# DEB_KDE_LINK_WITH_AS_NEEDED ?= yes

DEB_BINARY_VERSION := $(shell dpkg-parsechangelog | grep '^Version: ' | sed 's/^Version: //')
DEB_KNETWORKMANAGER_VERSION := $(shell echo '$(DEB_BINARY_VERSION)' | sed 's/^[[:digit:].]\+/1:0.9/')

override_dh_auto_configure:
	dh_auto_configure -Skde -- -DCMAKE_USE_RELATIVE_PATHS=ON -DDBUS_SYSTEM_POLICY_DIR=/etc/dbus-1/system.d -DINSTALL_KNM_AUTOSTART=ON

override_dh_auto_install:
	dh_auto_install
	# Ship network.svgz uncompressed as network.svg in order to avoid file
	# conflict with kdebase-runtime-data (>= 4:4.5) but still keep
	# compatibility with KDE SC 4.4
	( cd debian/tmp/usr/share/kde4/apps/desktoptheme/default/icons && \
	  gunzip -c network.svgz > network.svg && rm -f network.svgz )

override_dh_makeshlibs:
	dh_makeshlibs -pknm-runtime -V'knm-runtime (= $(DEB_BINARY_VERSION))'
	dh_makeshlibs --remaining-packages

override_dh_gencontrol:
	dh_gencontrol -pnetwork-manager-kde -- -v'$(DEB_KNETWORKMANAGER_VERSION)' \
        -V'knetworkmanager:Version=$(DEB_KNETWORKMANAGER_VERSION)'
	dh_gencontrol --remaining-packages -- \
        -V'knetworkmanager:Version=$(DEB_KNETWORKMANAGER_VERSION)'

%:
	dh --parallel --with kde --dbg-package=plasma-widget-networkmanagement-dbg $@

.PHONY: override_dh_auto_test
